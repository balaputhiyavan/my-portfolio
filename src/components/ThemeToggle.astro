---
// ThemeToggle.astro
---

<button
  id="theme-toggle"
  type="button"
  class="relative w-[3.25rem] h-7 rounded-full cursor-pointer shadow-sm focus:outline-none transition-all duration-300 overflow-hidden group border border-blue-500/50 dark:border-gray-600 p-0.5"
  aria-label="Toggle theme"
>
    <!-- Track Backgrounds -->
    <div class="absolute inset-0 w-full h-full rounded-full transition-colors duration-500">
        <!-- Night Sky (Visible in Dark Mode) -->
        <div class="absolute inset-0 bg-slate-900 transition-opacity duration-500 ease-in-out opacity-0 dark:opacity-100">
             <!-- Stars -->
             <div class="absolute top-1.5 left-3 w-0.5 h-0.5 bg-white rounded-full opacity-100"></div>
             <div class="absolute top-3 left-6 w-0.5 h-0.5 bg-white rounded-full opacity-80"></div>
             <div class="absolute bottom-2 left-4 w-0.5 h-0.5 bg-white rounded-full opacity-60"></div>
        </div>

        <!-- Day Sky (Visible in Light Mode) -->
        <div class="absolute inset-0 bg-white transition-opacity duration-500 ease-in-out opacity-100 dark:opacity-0">
             <!-- Subtle Cloud/Gradient -->
             <div class="absolute inset-0 bg-gradient-to-r from-blue-50 to-white"></div>
        </div>
    </div>

    <!-- Sliding Thumb -->
    <div 
        class="relative w-5 h-5 rounded-full shadow-md transform transition-transform duration-500 cubic-bezier(0.4, 0.0, 0.2, 1) z-10
               translate-x-0 dark:translate-x-6
               flex items-center justify-center overflow-hidden"
    >
        <!-- Moon State (Active in Light Mode - Thumb on Left) -->
        <div class="absolute inset-0 bg-slate-800 transition-opacity duration-300 opacity-100 dark:opacity-0 flex items-center justify-center rounded-full">
            <svg class="w-3 h-3 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
            </svg>
        </div>

        <!-- Sun State (Active in Dark Mode - Thumb on Right) -->
        <div class="absolute inset-0 bg-yellow-400 transition-opacity duration-300 opacity-0 dark:opacity-100 flex items-center justify-center rounded-full">
             <svg class="w-3.5 h-3.5 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
             </svg>
        </div>
    </div>
</button>

<script is:inline>
  const handleToggleClick = () => {
    const element = document.documentElement;
    element.classList.toggle("dark");

    const isDark = element.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");
  }

  const toggleBtn = document.getElementById("theme-toggle");
  if (toggleBtn) {
      toggleBtn.addEventListener("click", handleToggleClick);
  }
  
  document.addEventListener("astro:after-swap", () => {
       const newToggleBtn = document.getElementById("theme-toggle");
       if (newToggleBtn) {
           newToggleBtn.addEventListener("click", handleToggleClick);
       }
  });
</script>
