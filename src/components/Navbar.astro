---
// component imports
import {Icon} from "astro-icon/components";
import ThemeToggle from "./ThemeToggle.astro";

// data imports
import {menu} from "../data/menu";

// config import
import {SITE} from "../config";

const pathname = Astro.url.pathname;
---

<nav class="fixed w-full z-40 top-0 start-0 transition-all duration-500 border-b border-transparent translate-y-0" id="menu">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4 md:px-8">
        <div class="flex items-center">
            <a href="/" class="text-2xl font-bold tracking-tighter text-slate-900 dark:text-white group">
                <span class="text-indigo-600 dark:text-indigo-400 group-hover:text-indigo-500 transition-colors">B</span>ala M<span>.</span>
            </a>
        </div>

        <div class="flex md:order-2 space-x-3 items-center">
            <div class="hidden md:block">
                <ThemeToggle />
            </div>
            <button id="btn-menu" data-collapse-toggle="navbar-sticky" type="button"
                    class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-xl md:hidden hover:bg-gray-100 dark:text-gray-400 dark:hover:bg-gray-800 focus:outline-none transition-colors"
                    aria-controls="navbar-sticky" aria-expanded="false">
                <span class="sr-only">Open main menu</span>
                <svg class="w-6 h-6" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 17 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 1h15M1 7h15M1 13h15"/>
                </svg>
            </button>
        </div>

        <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1" id="navbar-sticky">
            <ul class="flex flex-col p-4 md:p-1 mt-4 font-medium border border-gray-100 rounded-2xl md:space-x-4 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 bg-white/50 dark:bg-slate-900/50 md:bg-transparent backdrop-blur-lg md:backdrop-blur-none items-center" id="nav-list">
                <li>
                    <a href="/#who-am-i" class="nav-link block py-2 px-4 rounded-xl text-slate-600 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-white transition-all duration-300">Bio</a>
                </li>
                <li>
                    <a href="/#skills" class="nav-link block py-2 px-4 rounded-xl text-slate-600 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-white transition-all duration-300">Skills</a>
                </li>
                <li>
                    <a href="/#projects" class="nav-link block py-2 px-4 rounded-xl text-slate-600 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-white transition-all duration-300">Projects</a>
                </li>
                <li>
                    <a href="/#contact" class="nav-link block py-2 px-4 rounded-xl text-slate-600 dark:text-slate-400 hover:text-indigo-600 dark:hover:text-white transition-all duration-300">Contact</a>
                </li>
                <li class="md:hidden pt-4 mt-4 border-t border-gray-200 dark:border-gray-700 w-full flex justify-center">
                    <ThemeToggle />
                </li>
            </ul>
        </div>
    </div>
</nav>

<style>
    .nav-link.active-section {
        @apply text-indigo-600 dark:text-white font-semibold bg-indigo-50/50 dark:bg-white/10;
    }

    /* Scrolled state for navbar */
    nav.scrolled {
        @apply bg-white/70 dark:bg-slate-950/70 backdrop-blur-xl border-slate-200/50 dark:border-white/10 py-2;
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    }
</style>

<script>
    function initNavbar() {
        const menu = document.getElementById('menu');
        const btnMenu = document.getElementById('btn-menu');
        const navbar = document.getElementById('navbar-sticky');

        // Scroll effect
        window.addEventListener('scroll', () => {
            if (window.scrollY > 20) {
                menu?.classList.add('scrolled');
            } else {
                menu?.classList.remove('scrolled');
            }
        });

        // Mobile menu toggle
        btnMenu?.addEventListener('click', () => {
            navbar?.classList.toggle('hidden');
        });

        // Close mobile menu on link click
        const navLinks = document.querySelectorAll('.nav-link');
        navLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (window.innerWidth < 768) {
                    navbar?.classList.add('hidden');
                }
            });
        });

        // Intersection Observer for active state
        const observerOptions = {
            root: null,
            rootMargin: '-20% 0px -70% 0px',
            threshold: 0
        };

        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const id = entry.target.getAttribute('id');
                    const activeLink = document.querySelector(`.nav-link[href$="#${id}"]`);
                    
                    if (activeLink) {
                        navLinks.forEach(link => link.classList.remove('active-section'));
                        activeLink.classList.add('active-section');
                    }
                }
            });
        }, observerOptions);

        const sections = document.querySelectorAll('section[id]');
        sections.forEach(section => observer.observe(section));
    }

    initNavbar();
    document.addEventListener('astro:after-swap', initNavbar);
</script>
