---
// component imports
import {Icon} from "astro-icon/components";
import ThemeToggle from "./ThemeToggle.astro";

// data imports
import {menu} from "../data/menu";

// config import
import {SITE} from "../config";

const pathname = Astro.url.pathname;
---

<nav class="bg-white/80 dark:bg-slate-950/70 backdrop-blur-md fixed w-full z-40 top-0 start-0 border-b border-slate-200/50 dark:border-white/5 transition-colors duration-500" id="menu">
    <div class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4 md:px-6">
        <!-- Logo removed as requested -->
        <div class="hidden md:block"></div>

        <div class="flex md:order-1 space-x-3 md:space-x-4 rtl:space-x-reverse items-center">
            <button id="btn-menu" data-collapse-toggle="navbar-sticky" type="button"
                    class="inline-flex items-center p-2 w-10 h-10 justify-center text-sm text-gray-500 rounded-lg md:hidden hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-gray-200 dark:text-gray-400 dark:hover:bg-gray-700 dark:focus:ring-gray-600"
                    aria-controls="navbar-sticky" aria-expanded="false">
                <span class="sr-only">Open main menu</span>
                <svg class="w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none"
                     viewBox="0 0 17 14">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M1 1h15M1 7h15M1 13h15"/>
                </svg>
            </button>
        </div>
        <div class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1 ml-auto" id="navbar-sticky">
            <!-- Navigation Links -->
            <ul class="relative flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg md:space-x-2 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 dark:border-gray-700 bg-gray-50 md:bg-transparent dark:bg-gray-800 md:dark:bg-transparent items-center" id="nav-list">
                <!-- Sliding Indicator (Underline style) -->
                <div id="nav-indicator" class="absolute hidden md:block h-[3px] bg-slate-900 dark:bg-white rounded-full transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] -z-10 opacity-0"></div>

                <li>
                    <a href="#who-am-i" data-text="Bio" class="nav-link block py-2 px-5 rounded md:p-0 text-slate-500 dark:text-slate-400 relative z-10 hover:text-slate-900 dark:hover:text-white transition-colors duration-300 text-center">Bio</a>
                </li>
                <li>
                    <a href="#skills" data-text="Skills" class="nav-link block py-2 px-5 rounded md:p-0 text-slate-500 dark:text-slate-400 relative z-10 hover:text-slate-900 dark:hover:text-white transition-colors duration-300 text-center">Skills</a>
                </li>
                <li>
                    <a href="#projects" data-text="Projects" class="nav-link block py-2 px-5 rounded md:p-0 text-slate-500 dark:text-slate-400 relative z-10 hover:text-slate-900 dark:hover:text-white transition-colors duration-300 text-center">Projects</a>
                </li>
                <li>
                    <a href="#contact" data-text="Contact" class="nav-link block py-2 px-5 rounded md:p-0 text-slate-500 dark:text-slate-400 relative z-10 hover:text-slate-900 dark:hover:text-white transition-colors duration-300 text-center">Contact</a>
                </li>
                <li class="pl-10 md:pl-12 border-l border-gray-200 dark:border-gray-700 ml-8 md:ml-10 flex items-center h-8">
                    <ThemeToggle />
                </li>
            </ul>
        </div>
    </div>
</nav>

<style>
    /* Active link text color if needed */
    .nav-link.active-section {
        @apply text-slate-900 dark:text-white font-bold;
    }

    /* Prevent layout shift on bold hover/active */
    .nav-link::after {
        content: attr(data-text);
        display: block;
        height: 0;
        visibility: hidden;
        overflow: hidden;
        user-select: none;
        pointer-events: none;
        font-weight: 700; /* Match bold weight */
        text-align: center;
    }
</style>

<script>
    function toggleNav() {
        const btnMenu = document.getElementById('btn-menu');
        const navbar = document.getElementById('navbar-sticky');

        btnMenu?.addEventListener('click', function () {
            navbar?.classList.toggle('hidden');
        });
    }

    function initNavIndicator() {
        const indicator = document.getElementById('nav-indicator');
        const list = document.getElementById('nav-list');
        const links = document.querySelectorAll('.nav-link');
        
        if (!indicator || !list) return;
        const navIndicator = indicator as HTMLElement;
        const navList = list as HTMLElement;

        function updateIndicator(el: any) {
            if (!el || !(el instanceof HTMLElement)) return;
            const rect = el.getBoundingClientRect();
            const parentRect = navList.getBoundingClientRect();
            
            // Underline positioning
            // We want it roughly the width of the text, so we calculate based on the element width minus some padding
            // The links have px-5 (20px each side = 40px total). 
            // Let's make the line width = rect.width - 24px (allowing a bit of overhang or just tighter than full pad)
            
            const widthCorrection = 24; 
            
            navIndicator.style.width = `${rect.width - widthCorrection}px`; 
            navIndicator.style.height = `3px`; // Fixed height for underline
            
            // Center horizontal: left + (correction / 2)
            navIndicator.style.left = `${rect.left - parentRect.left + (widthCorrection / 2)}px`; 
            
            // Position at bottom: top + height - specific offset to sit nicely under text
            // rect.height is the full link block. 
            // We want it at the bottom edge.
            navIndicator.style.top = `${rect.bottom - parentRect.top - 4}px`; // -4px to pull it up slightly
            
            navIndicator.style.opacity = '1';
        }

        // Mouse Enter: Follow cursor
        links.forEach(link => {
            link.addEventListener('mouseenter', (e) => updateIndicator(e.target));
        });

        // Mouse Leave: Snap back to active section
        list.addEventListener('mouseleave', () => {
             const activeLink = document.querySelector('.nav-link.active-section');
             if (activeLink) {
                 updateIndicator(activeLink);
             } else {
                 navIndicator.style.opacity = '0';
             }
        });
        
        // Scroll Observer
        const sections = document.querySelectorAll('section');
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                const link = document.querySelector(`.nav-link[href="#${id}"]`);
                
                if (entry.isIntersecting && link) {
                   links.forEach(l => l.classList.remove('active-section'));
                   link.classList.add('active-section');
                   
                   // Only update indicator if user isn't hovering (prevents fighting cursor)
                   if (!list.matches(':hover')) {
                       updateIndicator(link);
                   }
                }
            });
        }, { threshold: 0.5 });
        
        sections.forEach(sec => observer.observe(sec));
    }

    toggleNav();
    initNavIndicator();

    document.addEventListener("astro:after-swap", () => {
        toggleNav();
        initNavIndicator();
    });
</script>