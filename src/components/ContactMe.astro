---
// No button import needed, using custom styles
---

<section id="contact" class="w-full py-20 px-4 mb-10 relative overflow-hidden snap-start">
    <!-- Background Elements -->
    <div class="absolute bottom-0 right-0 w-[300px] h-[300px] bg-accent-purple blur-[120px] opacity-20 rounded-full pointer-events-none"></div>

    <div class="max-w-4xl mx-auto relative z-10">
        <div class="text-center mb-16">
            <h2 class="text-4xl md:text-5xl font-bold mb-4 text-n900 dark:text-white">Get In Touch</h2>
            <p class="text-lg text-n500 dark:text-n300">Have a project in mind? Let's build something amazing together.</p>
        </div>
        
        <div class="glass-panel p-8 md:p-10 rounded-[48px]">
            <form id="contact-form" action="https://api.web3forms.com/submit" method="POST" class="flex flex-col gap-8">
                <!-- Web3Forms Config: Get your key at https://web3forms.com/ -->
                <input type="hidden" name="access_key" value="fff6d97c-64a2-4cb5-b58b-095c6f090c5c">
                <input type="hidden" name="subject" value="New Portfolio Message">
                <input type="hidden" name="from_name" value="Portfolio Contact Form">
                <input type="checkbox" name="botcheck" class="hidden" style="display: none;">

                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="flex flex-col gap-2 group">
                        <label for="name" class="text-sm font-bold text-n700 dark:text-n200 uppercase tracking-wider">Name</label>
                        <input 
                            type="text" 
                            id="name" 
                            name="name" 
                            placeholder="John Doe"
                            required
                            class="bg-transparent border-b-2 border-n300 dark:border-n700 py-3 text-lg focus:outline-none focus:border-primary-light dark:focus:border-primary-dark transition-colors duration-300 placeholder:text-n300 dark:placeholder:text-n700 text-n900 dark:text-white"
                        />
                    </div>
                    
                    <div class="flex flex-col gap-2 group">
                        <label for="email" class="text-sm font-bold text-n700 dark:text-n200 uppercase tracking-wider">Email</label>
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            placeholder="john@example.com"
                            required
                            class="bg-transparent border-b-2 border-n300 dark:border-n700 py-3 text-lg focus:outline-none focus:border-primary-light dark:focus:border-primary-dark transition-colors duration-300 placeholder:text-n300 dark:placeholder:text-n700 text-n900 dark:text-white"
                        />
                    </div>
                </div>
                
                <div class="flex flex-col gap-2 group">
                    <label for="message" class="text-sm font-bold text-n700 dark:text-n200 uppercase tracking-wider">Message</label>
                    <textarea 
                        id="message" 
                        name="message" 
                        rows="4"
                        placeholder="Tell me about your project..."
                        required
                        class="bg-transparent border-b-2 border-n300 dark:border-n700 py-3 text-lg focus:outline-none focus:border-primary-light dark:focus:border-primary-dark transition-colors duration-300 placeholder:text-n300 dark:placeholder:text-n700 text-n900 dark:text-white resize-none"
                    ></textarea>
                </div>
                
                <div class="flex flex-col md:flex-row items-center justify-between gap-6 pt-4">
                    <div id="form-status" class="text-sm hidden"></div>
                    <button type="submit" id="submit-btn" class="w-full md:w-auto px-10 py-4 rounded-full font-bold text-white bg-gradient-to-r from-primary-light to-accent-purple dark:from-primary-dark dark:to-accent-pink hover:opacity-90 hover:scale-[1.02] active:scale-95 transition-all duration-300 shadow-xl hover:shadow-primary-light/40 dark:hover:shadow-primary-dark/40 disabled:opacity-50 disabled:cursor-not-allowed">
                        Send Message
                    </button>
                </div>
            </form>
        </div>
    </div>
</section>

<script is:inline>
    const setupContactForm = () => {
        const form = document.getElementById('contact-form');
        if (!form) return;

        const status = document.getElementById('form-status');
        const submitBtn = document.getElementById('submit-btn');

        const handleSubmit = async (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            const accessKey = formData.get('access_key');

            if (accessKey === 'YOUR_ACCESS_KEY_HERE') {
                status.textContent = '⚠️ Error: You must add your Web3Forms Access Key in ContactMe.astro (line 18).';
                status.className = 'text-sm text-red-500 font-medium block p-4 bg-red-500/10 rounded-xl border border-red-500/20';
                status.classList.remove('hidden');
                // Scroll to status
                status.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';
            status.className = 'text-sm text-blue-500 font-medium block';
            status.textContent = 'Sending your message...';
            status.classList.remove('hidden');

            try {
                const response = await fetch(form.action, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                const result = await response.json();

                if (response.status === 200) {
                    status.textContent = '✅ Success! Your message has been sent.';
                    status.className = 'text-sm text-green-500 font-medium block p-4 bg-green-500/10 rounded-xl border border-green-500/20';
                    form.reset();
                } else {
                    status.textContent = `❌ Error: ${result.message || 'Submission failed.'}`;
                    status.className = 'text-sm text-red-500 font-medium block p-4 bg-red-500/10 rounded-xl border border-red-500/20';
                }
            } catch (error) {
                status.textContent = '❌ Error: Something went wrong. Please try again later.';
                status.className = 'text-sm text-red-500 font-medium block p-4 bg-red-500/10 rounded-xl border border-red-500/20';
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Send Message';
            }
        };

        // Remove old listener if any and add new one
        form.removeEventListener('submit', handleSubmit);
        form.addEventListener('submit', handleSubmit);
    };

    // Initial load
    setupContactForm();

    // Re-run on every navigation
    document.addEventListener('astro:after-swap', setupContactForm);
</script>
